# Equivalent to:
# az group create --name "${RESOURCEGROUPNAME}" --location "${REGION}"
# This YAML creates a Resource Group named "${RESOURCEGROUPNAME}" in the specified Azure region "${REGION}".
apiVersion: resources.azure.com/v1api20200601
kind: ResourceGroup
metadata:
  name: ${RESOURCEGROUPNAME}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
---
# Equivalent to:
# az network vnet create -n "${VNET}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a virtual network named "${VNET}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: network.azure.com/v1api20201101
kind: VirtualNetwork
metadata:
  name: ${VNET}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  addressSpace:
    addressPrefixes:
      - 10.100.0.0/15
---
# Equivalent to:
# az network nsg create -n "${NSG}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a Network Security Group (NSG) named "${NSG}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: network.azure.com/v1api20201101
kind: NetworkSecurityGroup
metadata:
  name: ${NSG}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
---
# Equivalent to:
# az network vnet subnet create -n "${SUBNET}" -g "${RESOURCEGROUPNAME}" --vnet-name "${VNET}" --network-security-group "${NSG}"
# This YAML creates a subnet named "${SUBNET}" in the "${VNET}" virtual network and associates it with the "${NSG}" Network Security Group.
apiVersion: network.azure.com/v1api20201101
kind: VirtualNetworksSubnet
metadata:
  name: ${VNET}-${SUBNET}
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${VNET}
  addressPrefix: 10.100.76.0/24
  azureName: ${SUBNET}
  networkSecurityGroup:
    reference:
      name: ${NSG}
      group: network.azure.com
      kind: NetworkSecurityGroup
---
# Equivalent to:
# az keyvault create --name "$KV" -g ${RESOURCEGROUPNAME} --location "${REGION}" --enable-rbac-authorization true
# This YAML creates a key vault named "${KV}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: keyvault.azure.com/v1api20230701
kind: Vault
metadata:
  name: "${KV}"
  namespace: ${NAMESPACE}
spec:
  location: "${REGION}"
  owner:
    name: "${RESOURCEGROUPNAME}"
  properties:
    createMode: createOrRecover
    enableRbacAuthorization: true
    enabledForDiskEncryption: false
    enabledForTemplateDeployment: false
    enableSoftDelete: true
    tenantId: "${AZURE_TENANT_ID}"
    accessPolicies: [] 
    sku:
      family: A
      name: standard
---
# Equivalent to:
# az identity create -n "${USER}-${CS_CLUSTER_NAME}-cp-control-plane-${OPERATORS_UAMIS_SUFFIX}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a managed identity named "${USER}-${CS_CLUSTER_NAME}-cp-control-plane-${OPERATORS_UAMIS_SUFFIX}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: managedidentity.azure.com/v1api20230131
kind: UserAssignedIdentity
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-control-plane-${OPERATORS_UAMIS_SUFFIX}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  operatorSpec:
    configMaps:
      principalId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-control-plane-${OPERATORS_UAMIS_SUFFIX}
        key: principalId
      clientId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-control-plane-${OPERATORS_UAMIS_SUFFIX}
        key: clientId
---
# Equivalent to:
# az identity create -n "${USER}-${CS_CLUSTER_NAME}-cp-cluster-api-azure-${OPERATORS_UAMIS_SUFFIX}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a managed identity named "${USER}-${CS_CLUSTER_NAME}-cp-cluster-api-azure-${OPERATORS_UAMIS_SUFFIX}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: managedidentity.azure.com/v1api20230131
kind: UserAssignedIdentity
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-cluster-api-azure-${OPERATORS_UAMIS_SUFFIX}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  operatorSpec:
    configMaps:
      principalId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-cluster-api-azure-${OPERATORS_UAMIS_SUFFIX}
        key: principalId
      clientId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-cluster-api-azure-${OPERATORS_UAMIS_SUFFIX}
        key: clientId
---
# Equivalent to:
# az identity create -n "${USER}-${CS_CLUSTER_NAME}-cp-cloud-controller-manager-${OPERATORS_UAMIS_SUFFIX}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a managed identity named "${USER}-${CS_CLUSTER_NAME}-cp-cloud-controller-manager-${OPERATORS_UAMIS_SUFFIX}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: managedidentity.azure.com/v1api20230131
kind: UserAssignedIdentity
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-cloud-controller-manager-${OPERATORS_UAMIS_SUFFIX}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  operatorSpec:
    configMaps:
      principalId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-cloud-controller-manager-${OPERATORS_UAMIS_SUFFIX}
        key: principalId
      clientId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-cloud-controller-manager-${OPERATORS_UAMIS_SUFFIX}
        key: clientId
---
# Equivalent to:
# az identity create -n "${USER}-${CS_CLUSTER_NAME}-cp-ingress-${OPERATORS_UAMIS_SUFFIX}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a managed identity named "${USER}-${CS_CLUSTER_NAME}-cp-ingress-${OPERATORS_UAMIS_SUFFIX}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: managedidentity.azure.com/v1api20230131
kind: UserAssignedIdentity
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-ingress-${OPERATORS_UAMIS_SUFFIX}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  operatorSpec:
    configMaps:
      principalId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-ingress-${OPERATORS_UAMIS_SUFFIX}
        key: principalId
      clientId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-ingress-${OPERATORS_UAMIS_SUFFIX}
        key: clientId
---
# Equivalent to:
# az identity create -n "${USER}-${CS_CLUSTER_NAME}-cp-disk-csi-driver-${OPERATORS_UAMIS_SUFFIX}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a managed identity named "${USER}-${CS_CLUSTER_NAME}-cp-disk-csi-driver-${OPERATORS_UAMIS_SUFFIX}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: managedidentity.azure.com/v1api20230131
kind: UserAssignedIdentity
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-disk-csi-driver-${OPERATORS_UAMIS_SUFFIX}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  operatorSpec:
    configMaps:
      principalId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-disk-csi-driver-${OPERATORS_UAMIS_SUFFIX}
        key: principalId
      clientId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-disk-csi-driver-${OPERATORS_UAMIS_SUFFIX}
        key: clientId
---
# Equivalent to:
# az identity create -n "${USER}-${CS_CLUSTER_NAME}-cp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a managed identity named "${USER}-${CS_CLUSTER_NAME}-cp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: managedidentity.azure.com/v1api20230131
kind: UserAssignedIdentity
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  operatorSpec:
    configMaps:
      principalId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}
        key: principalId
      clientId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}
        key: clientId
---
# Equivalent to:
# az identity create -n "${USER}-${CS_CLUSTER_NAME}-cp-image-registry-${OPERATORS_UAMIS_SUFFIX}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a managed identity named "${USER}-${CS_CLUSTER_NAME}-cp-image-registry-${OPERATORS_UAMIS_SUFFIX}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: managedidentity.azure.com/v1api20230131
kind: UserAssignedIdentity
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-image-registry-${OPERATORS_UAMIS_SUFFIX}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  operatorSpec:
    configMaps:
      principalId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-image-registry-${OPERATORS_UAMIS_SUFFIX}
        key: principalId
      clientId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-image-registry-${OPERATORS_UAMIS_SUFFIX}
        key: clientId
---
# Equivalent to:
# az identity create -n "${USER}-${CS_CLUSTER_NAME}-cp-cloud-network-config-${OPERATORS_UAMIS_SUFFIX}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a managed identity named "${USER}-${CS_CLUSTER_NAME}-cp-cloud-network-config-${OPERATORS_UAMIS_SUFFIX}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: managedidentity.azure.com/v1api20230131
kind: UserAssignedIdentity
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-cloud-network-config-${OPERATORS_UAMIS_SUFFIX}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  operatorSpec:
    configMaps:
      principalId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-cloud-network-config-${OPERATORS_UAMIS_SUFFIX}
        key: principalId
      clientId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-cloud-network-config-${OPERATORS_UAMIS_SUFFIX}
        key: clientId
---
# Equivalent to:
# az identity create -n "${USER}-${CS_CLUSTER_NAME}-cp-kms-${OPERATORS_UAMIS_SUFFIX}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a managed identity named "${USER}-${CS_CLUSTER_NAME}-cp-kms-${OPERATORS_UAMIS_SUFFIX}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: managedidentity.azure.com/v1api20230131
kind: UserAssignedIdentity
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-kms-${OPERATORS_UAMIS_SUFFIX}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  operatorSpec:
    configMaps:
      principalId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-kms-${OPERATORS_UAMIS_SUFFIX}
        key: principalId
      clientId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-kms-${OPERATORS_UAMIS_SUFFIX}
        key: clientId
---
# Equivalent to:
# az identity create -n "${USER}-${CS_CLUSTER_NAME}-dp-disk-csi-driver-${OPERATORS_UAMIS_SUFFIX}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a managed identity named "${USER}-${CS_CLUSTER_NAME}-dp-disk-csi-driver-${OPERATORS_UAMIS_SUFFIX}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: managedidentity.azure.com/v1api20230131
kind: UserAssignedIdentity
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-dp-disk-csi-driver-${OPERATORS_UAMIS_SUFFIX}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  operatorSpec:
    configMaps:
      principalId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-dp-disk-csi-driver-${OPERATORS_UAMIS_SUFFIX}
        key: principalId
      clientId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-dp-disk-csi-driver-${OPERATORS_UAMIS_SUFFIX}
        key: clientId
---
# Equivalent to:
# az identity create -n "${USER}-${CS_CLUSTER_NAME}-dp-image-registry-${OPERATORS_UAMIS_SUFFIX}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a managed identity named "${USER}-${CS_CLUSTER_NAME}-dp-image-registry-${OPERATORS_UAMIS_SUFFIX}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: managedidentity.azure.com/v1api20230131
kind: UserAssignedIdentity
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-dp-image-registry-${OPERATORS_UAMIS_SUFFIX}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  operatorSpec:
    configMaps:
      principalId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-dp-image-registry-${OPERATORS_UAMIS_SUFFIX}
        key: principalId
      clientId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-dp-image-registry-${OPERATORS_UAMIS_SUFFIX}
        key: clientId
---
# Equivalent to:
# az identity create -n "${USER}-${CS_CLUSTER_NAME}-dp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a managed identity named "${USER}-${CS_CLUSTER_NAME}-dp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: managedidentity.azure.com/v1api20230131
kind: UserAssignedIdentity
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-dp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  operatorSpec:
    configMaps:
      principalId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-dp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}
        key: principalId
      clientId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-dp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}
        key: clientId
---
# Equivalent to:
# az identity create -n "${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}" -g "${RESOURCEGROUPNAME}"
# This YAML creates a managed identity named "${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}" in the "${RESOURCEGROUPNAME}" resource group.
apiVersion: managedidentity.azure.com/v1api20230131
kind: UserAssignedIdentity
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
  namespace: ${NAMESPACE}
spec:
  location: ${REGION}
  owner:
    name: ${RESOURCEGROUPNAME}
  operatorSpec:
    configMaps:
      principalId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
        key: principalId
      clientId:
        name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
        key: clientId
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-cluster-api-azure-${OPERATORS_UAMIS_SUFFIX}-hcpclusterapiproviderroleid-subnet
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${VNET}-${SUBNET}
    group: network.azure.com
    kind: VirtualNetworksSubnet
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-cluster-api-azure-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # 88366f10-ed47-4cc0-9fab-c8a06148393e represents 'hcpClusterApiProviderRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/88366f10-ed47-4cc0-9fab-c8a06148393e
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-readerroleid-clusterapiazuremi
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${USER}-${CS_CLUSTER_NAME}-cp-cluster-api-azure-${OPERATORS_UAMIS_SUFFIX}
    group: managedidentity.azure.com
    kind: UserAssignedIdentity
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # acdd72a7-3385-48ef-bd42-f606fba81ae7 represents 'readerRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-kms-${OPERATORS_UAMIS_SUFFIX}-keyvaultcryptouserroleid-keyvault
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${KV}
    group: keyvault.azure.com
    kind: Vault
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-kms-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # 12338af0-0e69-4776-bea7-57ae8d297424 represents 'keyVaultCryptoUserRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/12338af0-0e69-4776-bea7-57ae8d297424
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-readerroleid-kmsmi
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${USER}-${CS_CLUSTER_NAME}-cp-kms-${OPERATORS_UAMIS_SUFFIX}
    group: managedidentity.azure.com
    kind: UserAssignedIdentity
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # acdd72a7-3385-48ef-bd42-f606fba81ae7 represents 'readerRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-control-plane-${OPERATORS_UAMIS_SUFFIX}-hcpcontrolplaneoperatorroleid-vnet
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${VNET}
    group: network.azure.com
    kind: VirtualNetwork
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-control-plane-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # fc0c873f-45e9-4d0d-a7d1-585aab30c6ed represents 'hcpControlPlaneOperatorRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/fc0c873f-45e9-4d0d-a7d1-585aab30c6ed
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-control-plane-${OPERATORS_UAMIS_SUFFIX}-hcpcontrolplaneoperatorroleid-nsg
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${NSG}
    group: network.azure.com
    kind: NetworkSecurityGroup
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-control-plane-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # fc0c873f-45e9-4d0d-a7d1-585aab30c6ed represents 'hcpControlPlaneOperatorRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/fc0c873f-45e9-4d0d-a7d1-585aab30c6ed
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-readerroleid-controlplanemi
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${USER}-${CS_CLUSTER_NAME}-cp-control-plane-${OPERATORS_UAMIS_SUFFIX}
    group: managedidentity.azure.com
    kind: UserAssignedIdentity
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # acdd72a7-3385-48ef-bd42-f606fba81ae7 represents 'readerRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-cloud-controller-manager-${OPERATORS_UAMIS_SUFFIX}-cloudcontrollermanagerroleid-subnet
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${VNET}-${SUBNET}
    group: network.azure.com
    kind: VirtualNetworksSubnet
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-cloud-controller-manager-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # a1f96423-95ce-4224-ab27-4e3dc72facd4 represents 'cloudControllerManagerRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/a1f96423-95ce-4224-ab27-4e3dc72facd4
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-cloud-controller-manager-${OPERATORS_UAMIS_SUFFIX}-cloudcontrollermanagerroleid-nsg
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${NSG}
    group: network.azure.com
    kind: NetworkSecurityGroup
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-cloud-controller-manager-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # a1f96423-95ce-4224-ab27-4e3dc72facd4 represents 'cloudControllerManagerRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/a1f96423-95ce-4224-ab27-4e3dc72facd4
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-readerroleid-cloudcontrollermanagermi
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${USER}-${CS_CLUSTER_NAME}-cp-cloud-controller-manager-${OPERATORS_UAMIS_SUFFIX}
    group: managedidentity.azure.com
    kind: UserAssignedIdentity
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # acdd72a7-3385-48ef-bd42-f606fba81ae7 represents 'readerRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-ingress-${OPERATORS_UAMIS_SUFFIX}-ingressoperatorroleid-subnet
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${VNET}-${SUBNET}
    group: network.azure.com
    kind: VirtualNetworksSubnet
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-ingress-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # 0336e1d3-7a87-462b-b6db-342b63f7802c represents 'ingressOperatorRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/0336e1d3-7a87-462b-b6db-342b63f7802c
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-readerroleid-ingressmi
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${USER}-${CS_CLUSTER_NAME}-cp-ingress-${OPERATORS_UAMIS_SUFFIX}
    group: managedidentity.azure.com
    kind: UserAssignedIdentity
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # acdd72a7-3385-48ef-bd42-f606fba81ae7 represents 'readerRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-readerroleid-diskcsidrivermi
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${USER}-${CS_CLUSTER_NAME}-cp-disk-csi-driver-${OPERATORS_UAMIS_SUFFIX}
    group: managedidentity.azure.com
    kind: UserAssignedIdentity
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # acdd72a7-3385-48ef-bd42-f606fba81ae7 represents 'readerRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}-filestorageoperatorroleid-subnet
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${VNET}-${SUBNET}
    group: network.azure.com
    kind: VirtualNetworksSubnet
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # 0d7aedc0-15fd-4a67-a412-efad370c947e represents 'fileStorageOperatorRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/0d7aedc0-15fd-4a67-a412-efad370c947e
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}-filestorageoperatorroleid-nsg
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${NSG}
    group: network.azure.com
    kind: NetworkSecurityGroup
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # 0d7aedc0-15fd-4a67-a412-efad370c947e represents 'fileStorageOperatorRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/0d7aedc0-15fd-4a67-a412-efad370c947e
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-readerroleid-filecsidrivermi
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${USER}-${CS_CLUSTER_NAME}-cp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}
    group: managedidentity.azure.com
    kind: UserAssignedIdentity
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # acdd72a7-3385-48ef-bd42-f606fba81ae7 represents 'readerRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-readerroleid-imageregistrymi
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${USER}-${CS_CLUSTER_NAME}-cp-image-registry-${OPERATORS_UAMIS_SUFFIX}
    group: managedidentity.azure.com
    kind: UserAssignedIdentity
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # acdd72a7-3385-48ef-bd42-f606fba81ae7 represents 'readerRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-cloud-network-config-${OPERATORS_UAMIS_SUFFIX}-networkoperatorroleid-subnet
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${VNET}-${SUBNET}
    group: network.azure.com
    kind: VirtualNetworksSubnet
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-cloud-network-config-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # be7a6435-15ae-4171-8f30-4a343eff9e8f represents 'networkOperatorRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/be7a6435-15ae-4171-8f30-4a343eff9e8f
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-cp-cloud-network-config-${OPERATORS_UAMIS_SUFFIX}-networkoperatorroleid-vnet
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${VNET}
    group: network.azure.com
    kind: VirtualNetwork
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-cp-cloud-network-config-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # be7a6435-15ae-4171-8f30-4a343eff9e8f represents 'networkOperatorRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/be7a6435-15ae-4171-8f30-4a343eff9e8f
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-readerroleid-cloudnetworkconfigmi
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${USER}-${CS_CLUSTER_NAME}-cp-cloud-network-config-${OPERATORS_UAMIS_SUFFIX}
    group: managedidentity.azure.com
    kind: UserAssignedIdentity
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # acdd72a7-3385-48ef-bd42-f606fba81ae7 represents 'readerRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/acdd72a7-3385-48ef-bd42-f606fba81ae7
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-federatedcredentialsroleid-dpdiskcsidrivermi
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${USER}-${CS_CLUSTER_NAME}-dp-disk-csi-driver-${OPERATORS_UAMIS_SUFFIX}
    group: managedidentity.azure.com
    kind: UserAssignedIdentity
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # ef318e2a-8334-4a05-9e4a-295a196c6a6e represents 'federatedCredentialsRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/ef318e2a-8334-4a05-9e4a-295a196c6a6e
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-federatedcredentialsroleid-dpfilecsidrivermi
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${USER}-${CS_CLUSTER_NAME}-dp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}
    group: managedidentity.azure.com
    kind: UserAssignedIdentity
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # ef318e2a-8334-4a05-9e4a-295a196c6a6e represents 'federatedCredentialsRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/ef318e2a-8334-4a05-9e4a-295a196c6a6e
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-dp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}-filestorageoperatorroleid-subnet
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${VNET}-${SUBNET}
    group: network.azure.com
    kind: VirtualNetworksSubnet
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-dp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # 0d7aedc0-15fd-4a67-a412-efad370c947e represents 'fileStorageOperatorRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/0d7aedc0-15fd-4a67-a412-efad370c947e
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-dp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}-filestorageoperatorroleid-nsg
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${NSG}
    group: network.azure.com
    kind: NetworkSecurityGroup
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-dp-file-csi-driver-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # 0d7aedc0-15fd-4a67-a412-efad370c947e represents 'fileStorageOperatorRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/0d7aedc0-15fd-4a67-a412-efad370c947e
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-federatedcredentialsroleid-dpimageregistrymi
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${USER}-${CS_CLUSTER_NAME}-dp-image-registry-${OPERATORS_UAMIS_SUFFIX}
    group: managedidentity.azure.com
    kind: UserAssignedIdentity
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # ef318e2a-8334-4a05-9e4a-295a196c6a6e represents 'federatedCredentialsRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/ef318e2a-8334-4a05-9e4a-295a196c6a6e
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-hcpservicemanagedidentityroleid-vnet
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${VNET}
    group: network.azure.com
    kind: VirtualNetwork
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # c0ff367d-66d8-445e-917c-583feb0ef0d4 represents 'hcpServiceManagedIdentityRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/c0ff367d-66d8-445e-917c-583feb0ef0d4
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-hcpservicemanagedidentityroleid-subnet
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${VNET}-${SUBNET}
    group: network.azure.com
    kind: VirtualNetworksSubnet
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # c0ff367d-66d8-445e-917c-583feb0ef0d4 represents 'hcpServiceManagedIdentityRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/c0ff367d-66d8-445e-917c-583feb0ef0d4
---
apiVersion: authorization.azure.com/v1api20220401
kind: RoleAssignment
metadata:
  name: ${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}-hcpservicemanagedidentityroleid-nsg
  namespace: ${NAMESPACE}
spec:
  owner:
    name: ${NSG}
    group: network.azure.com
    kind: NetworkSecurityGroup
  principalIdFromConfig:
    name: identity-map-${USER}-${CS_CLUSTER_NAME}-service-managed-identity-${OPERATORS_UAMIS_SUFFIX}
    key: principalId
  principalType: ServicePrincipal
  roleDefinitionReference:
    # c0ff367d-66d8-445e-917c-583feb0ef0d4 represents 'hcpServiceManagedIdentityRoleId'
    armId: /subscriptions/${AZURE_SUBSCRIPTION_ID}/providers/Microsoft.Authorization/roleDefinitions/c0ff367d-66d8-445e-917c-583feb0ef0d4

